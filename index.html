<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beer Translate</title>
    <style>
        body {
            background-color: #121316;
            color: #e8eaed;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Скрываем скроллы */
            user-select: none; /* Чтобы текст не выделялся при перетаскивании */
            -webkit-user-select: none;
        }

        /* Заголовок и автор */
        .title-container {
            margin-bottom: 20px;
            display: flex;
            align-items: baseline;
            gap: 10px;
            cursor: default;
        }

        h1 { 
            font-weight: 400; 
            font-size: 32px; 
            color: #bdc1c6; 
            margin: 0; 
        }

        .author-tag {
            font-size: 14px;
            color: #5f6368;
            font-weight: 500;
            opacity: 0.7;
        }

        .translator-container {
            background-color: #1e1f21;
            border: 1px solid #3c4043;
            border-radius: 12px;
            width: 95%;
            max-width: 1100px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
            z-index: 1;
        }

        .header-tabs {
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid #3c4043;
            height: 55px;
        }

        .tab { 
            color: #8ab4f8; 
            font-size: 14px; 
            font-weight: 500; 
            border-bottom: 2px solid #8ab4f8; 
            height: 100%; 
            display: flex; 
            align-items: center; 
            padding: 0 10px; 
            cursor: pointer;
        }
        
        .tab.inactive {
            border-bottom: 2px solid transparent;
            color: #9aa0a6;
            cursor: default;
        }

        .swap-icon { margin: 0 20px; color: #9aa0a6; cursor: pointer; font-size: 24px; transition: 0.3s; }
        .swap-icon:hover { color: #fff; transform: rotate(180deg); }

        /* Кнопка Gravity */
        .gravity-tab {
            margin-left: auto;
            color: #9aa0a6;
            font-size: 13px;
            text-transform: uppercase;
            font-weight: bold;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.2s;
            letter-spacing: 0.5px;
        }
        
        .gravity-tab:hover {
            color: #e8eaed;
            background-color: rgba(255, 255, 255, 0.05);
        }

        .main-panels { display: flex; flex-wrap: wrap; }

        .panel { flex: 1; min-width: 300px; min-height: 250px; padding: 25px; position: relative; box-sizing: border-box; display: flex; flex-direction: column; background: #1e1f21; }
        .input-panel { border-right: 1px solid #3c4043; }

        textarea {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 22px;
            resize: none;
            outline: none;
            font-family: inherit;
            padding: 0;
        }

        #output-field {
            font-size: 22px;
            color: #bdc1c6;
            word-break: break-all;
            white-space: pre-wrap;
            flex-grow: 1;
            margin-bottom: 30px;
        }

        .clear-btn { position: absolute; top: 20px; right: 20px; color: #9aa0a6; cursor: pointer; font-size: 22px; z-index: 10; }
        .clear-btn:hover { color: #fff; }

        .panel-footer { position: absolute; bottom: 12px; right: 12px; }
        
        .copy-btn {
            background: transparent;
            border: none;
            color: #9aa0a6;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .copy-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .copy-btn svg { width: 24px; height: 24px; fill: currentColor; }

        @media (max-width: 768px) {
            .input-panel { border-right: none; border-bottom: 1px solid #3c4043; }
        }
    </style>
</head>
<body>

    <div class="title-container">
        <h1>Beer Translate</h1>
        <span class="author-tag">by spiderkaras</span>
    </div>

    <div class="translator-container">
        <div class="header-tabs">
            <div class="tab" id="left-label">Текст</div>
            <div class="swap-icon" onclick="toggleMode()">⇄</div>
            <div class="tab inactive" id="right-label">Пивной язык</div>
            
            <div class="gravity-tab" onclick="startGravity()">Gravity</div>
        </div>

        <div class="main-panels">
            <div class="panel input-panel">
                <div class="clear-btn" onclick="clearAll()">✕</div>
                <textarea id="input-text" placeholder="Введите текст..." oninput="doTranslate()"></textarea>
            </div>
            <div class="panel">
                <div id="output-field"></div>
                <div class="panel-footer">
                    <button class="copy-btn" id="copy-btn" onclick="copyResult()" title="Копировать">
                        <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
    /* --- ЛОГИКА ПЕРЕВОДЧИКА --- */
    const beerMap = {
        'А': 'влдаолдцт3894', 'Б': '78ем9т4325243895тм72', 'В': 'атдлжиыфвеи0653', 'Г': 'тмщышевз34',
        'Д': '34три537уиадлвы', 'Е': 'ь02м392м7', 'Ё': 'ь02м392м8', 'Ж': 'тт32м4о35т2',
        'З': '3и45рт647ь8', 'И': '49и357т7т50иц7', 'Й': '49и357т7т50иц8', 'К': 'тй89и5446',
        'Л': '7ьт47тть75', 'М': '7ь65бь47456ь7', 'Н': '8674ь5б867куекв', 'О': 'ь7т3567о5643654',
        'П': 'т76376534ывтн', 'Р': 'вьтапгь67767ь5ке', 'С': 'пиавые54', 'Т': 'т65436отекнр',
        'У': '6т54у65т6цу3', 'Ф': '74567о5тнит7546', 'Х': '547т456756т85', 'Ц': '7ль564л7от546р546',
        'Ч': '87645ьт5куьлнаенген', 'Ш': 'аеткуну45654н', 'Щ': 'аеткуну45654н1', 'Ъ': '22987т6и0222лвдпфы1',
        'Ы': '22987т6и0222лвдпфы3', 'Ь': '22987т6и0222лвдпфы2', 'Э': '638ь54и96346и0345', 'Ю': 'е0ц4539и587т3450879345',
        'Я': 'еьекутнтек6ня',
        'A': 'z99x11v', 'B': 'bb77beer00', 'C': 'c_shakal_99', 'D': 'd88_vottak_2', 'E': 'e_pivo_1',
        'F': 'f_44_ff', 'G': 'g_top_g_7', 'H': 'h_hh_888', 'I': 'i_eye_111', 'J': 'j_jack_55',
        'K': 'k_kick_0', 'L': 'l_lose_77', 'M': 'm_m_444555', 'N': 'n_nitro_9', 'O': 'o_zero_00',
        'P': 'p_pub_4', 'Q': 'q_quest_1', 'R': 'r_root_66', 'S': 's_snk_33', 'T': 't_tank_4',
        'U': 'u_unit_22', 'V': 'v_v_666', 'W': 'w_wow_7', 'X': 'x_xxx_0', 'Y': 'y_yes_9', 'Z': 'z_zzz_1'
    };

    const reverseCodes = Object.entries(beerMap)
        .map(([letter, code]) => ({ letter, code }))
        .sort((a, b) => b.code.length - a.code.length);

    let isBeerToText = false;

    function toggleMode() {
        isBeerToText = !isBeerToText;
        document.getElementById('left-label').innerText = isBeerToText ? 'Пивной язык' : 'Текст';
        document.getElementById('right-label').innerText = isBeerToText ? 'Текст' : 'Пивной язык';
        clearAll();
    }

    function doTranslate() {
        const input = document.getElementById('input-text').value;
        const output = document.getElementById('output-field');
        if (!input) { output.innerText = ''; return; }

        if (!isBeerToText) {
            let result = '';
            for (let char of input.toUpperCase()) {
                result += beerMap[char] || char;
            }
            output.innerText = result;
        } else {
            let result = '';
            let i = 0;
            while (i < input.length) {
                let found = false;
                for (let item of reverseCodes) {
                    if (input.substr(i, item.code.length) === item.code) {
                        result += item.letter;
                        i += item.code.length;
                        found = true;
                        break;
                    }
                }
                if (!found) { result += input[i]; i++; }
            }
            output.innerText = result.toLowerCase();
        }
    }

    function clearAll() {
        document.getElementById('input-text').value = '';
        document.getElementById('output-field').innerText = '';
    }

    function copyResult() {
        const text = document.getElementById('output-field').innerText;
        if (!text) return;
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(animateCopy);
        } else {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.select();
            try { document.execCommand('copy'); animateCopy(); } catch (err) {}
            document.body.removeChild(textArea);
        }
    }

    function animateCopy() {
        const btn = document.getElementById('copy-btn');
        const oldSvg = btn.innerHTML;
        btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
        btn.style.color = '#8ab4f8';
        setTimeout(() => {
            btn.innerHTML = oldSvg;
            btn.style.color = '';
        }, 2000);
    }

    /* --- ЛОГИКА ГРАВИТАЦИИ И ПЕРЕТАСКИВАНИЯ --- */
    let gravityActive = false;
    let physicsObjects = [];
    let dragTarget = null;
    let dragOffset = { x: 0, y: 0 };
    let lastMousePos = { x: 0, y: 0 };
    
    // Переменные мыши
    let mouseX = 0;
    let mouseY = 0;

    function startGravity() {
        if (gravityActive) return;
        gravityActive = true;

        // Отключаем выделение текста глобально, чтобы не мешало таскать
        document.body.style.userSelect = 'none';

        // 1. Собираем элементы
        let elements = [
            document.querySelector('.title-container'),
            document.querySelector('.input-panel'),
            document.querySelector('.panel:last-child'),
            document.querySelector('.translator-container')
        ];

        // Добавляем кусочки хедера
        document.querySelectorAll('.header-tabs > div').forEach(el => elements.push(el));
        elements = elements.filter(el => el);

        // 2. Создаем физ. объекты
        elements.forEach(el => {
            const rect = el.getBoundingClientRect();
            
            physicsObjects.push({
                el: el,
                x: rect.left,
                y: rect.top,
                w: rect.width,
                h: rect.height,
                vx: (Math.random() - 0.5) * 10, 
                vy: 0, 
                rot: 0,
                vrot: (Math.random() - 0.5) * 0.2,
                bounciness: 0.5 + Math.random() * 0.3,
                isDragging: false
            });
        });

        // 3. Переносим в absolute
        physicsObjects.forEach(obj => {
            const el = obj.el;
            el.style.width = obj.w + 'px';
            el.style.height = obj.h + 'px';
            el.style.boxSizing = 'border-box';
            el.style.margin = '0';
            el.style.position = 'absolute';
            el.style.left = '0';
            el.style.top = '0';
            el.style.transform = `translate(${obj.x}px, ${obj.y}px)`;
            el.style.zIndex = '1000';
            document.body.appendChild(el);
        });

        // 4. Подключаем слушатели событий мыши/тача
        window.addEventListener('mousedown', handleDown);
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('mouseup', handleUp);
        
        // Для телефонов
        window.addEventListener('touchstart', handleDown, {passive: false});
        window.addEventListener('touchmove', handleMove, {passive: false});
        window.addEventListener('touchend', handleUp);

        animate();
    }

    function handleDown(e) {
        if (!gravityActive) return;
        
        // Получаем координаты (мышь или палец)
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        mouseX = cx; 
        mouseY = cy;
        lastMousePos = { x: cx, y: cy };

        // Ищем, попали ли в объект (проверяем с конца массива, т.к. последние слои выше)
        for (let i = physicsObjects.length - 1; i >= 0; i--) {
            const obj = physicsObjects[i];
            
            // Простая проверка попадания в прямоугольник (без учета поворота для простоты)
            // При сильном вращении клик может быть неточным, но для хаоса пойдет
            if (cx >= obj.x && cx <= obj.x + obj.w &&
                cy >= obj.y && cy <= obj.y + obj.h) {
                
                dragTarget = obj;
                obj.isDragging = true;
                obj.vx = 0;
                obj.vy = 0;
                // Считаем смещение курсора относительно угла объекта
                dragOffset.x = cx - obj.x;
                dragOffset.y = cy - obj.y;
                
                // Поднимаем Z-index активного элемента
                obj.el.style.zIndex = '2000';
                
                // Блокируем скролл на мобильных
                if(e.cancelable) e.preventDefault();
                break;
            }
        }
    }

    function handleMove(e) {
        if (!gravityActive) return;
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        
        mouseX = cx;
        mouseY = cy;

        if (dragTarget) {
            if(e.cancelable) e.preventDefault(); 
        }
    }

    function handleUp() {
        if (dragTarget) {
            dragTarget.isDragging = false;
            dragTarget.el.style.zIndex = '1000';
            dragTarget = null;
        }
    }

    // 5. Физический цикл
    const gravity = 0.6;
    const floorFriction = 0.90;

    function animate() {
        const screenW = window.innerWidth;
        const screenH = window.innerHeight;

        physicsObjects.forEach(obj => {
            if (obj.isDragging) {
                // Если тащим - позиция следует за мышью
                const newX = mouseX - dragOffset.x;
                const newY = mouseY - dragOffset.y;

                // Вычисляем скорость "броска" (разница координат)
                obj.vx = (newX - obj.x) * 0.8; // 0.8 для плавности
                obj.vy = (newY - obj.y) * 0.8;

                obj.x = newX;
                obj.y = newY;
                
                // Сбрасываем вращение или медленно крутим при перетаскивании
                obj.vrot = obj.vx * 0.02; 

            } else {
                // Обычная физика
                obj.vy += gravity;
                obj.x += obj.vx;
                obj.y += obj.vy;
                obj.rot += obj.vrot;

                // Пол
                if (obj.y + obj.h > screenH) {
                    obj.y = screenH - obj.h;
                    obj.vy *= -obj.bounciness;
                    obj.vx *= floorFriction;
                    obj.vrot *= 0.9;
                    if (Math.abs(obj.vy) < gravity) obj.vy = 0;
                }
                
                // Потолок (чтобы не улетали совсем вверх)
                if (obj.y < -500) { obj.y = -500; obj.vy = 0; }

                // Стены
                if (obj.x < 0) {
                    obj.x = 0;
                    obj.vx *= -obj.bounciness;
                }
                if (obj.x + obj.w > screenW) {
                    obj.x = screenW - obj.w;
                    obj.vx *= -obj.bounciness;
                }
            }

            obj.el.style.transform = `translate(${obj.x}px, ${obj.y}px) rotate(${obj.rot}rad)`;
        });

        // Сохраняем прошлую позицию мыши для расчета инерции
        lastMousePos.x = mouseX;
        lastMousePos.y = mouseY;

        requestAnimationFrame(animate);
    }
</script>
</body>
</html>
